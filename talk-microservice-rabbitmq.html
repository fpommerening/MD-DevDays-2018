<!doctype html>
<html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Microservices mit RabbitMQ</title>

<meta name="description" content="Microservices mit RabbitMQ - Magdeburger Developer Days">
<meta name="author" content="Frank Pommerening">

<link rel="stylesheet" href="./common/css/reveal.css">
<link rel="stylesheet" href="./common/css/global.css">
<link rel="stylesheet" href="./common/css/theme/black.css" id="theme">

<!-- Theme used for syntax highlighting of code -->
<link rel="stylesheet" href="./common/lib/css/zenburn.css">

<!-- Printing and PDF exports -->
<script>
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match(/print-pdf/gi) ? './common/css/print/pdf.css' : './common/css/print/paper.css';
    document.getElementsByTagName('head')[0].appendChild(link);
</script>

<body>
    <div class="reveal">
        <div class="slides">
            <section>
                <h1>Microservices mit RabbitMQ</h1>
                <h2>Magdeburger Developer Days 2018</h2>
                <h3>11.04.2018</h3>
            </section>
            <section>
                <section>
                    <h2>Frank Pommerening</h2>
                    <img src="images/fp.jpg" style="border:0px;width:175px">
                    <ul>
                        <li>Senior - Softwareentwickler</li>
                        <li>Consultant</li>
                        <li>Softwarearchitekt</li>
                    </ul>
                    <br />
                    <br />
                    <a href="mailto:frank@pommerening-online.de">frank@pommerening-online.de</a>
                </section>
                <section data-background="images/axp.svg">
                    AXP Consulting GmbH & Co. KG in Leipzig
                    <br/> Gründung: Mai 2012
                    <br /> Anzahl Mitarbeiter: 8 feste
                    <br/> Branchenfokus: Energiebranche
                    <br/>
                    <br/>
                    <br/>
                    <ul>

                        <li>Consulting (fachlich & IT)
                            <ul>
                                <li>Requirements Engineering / Projektmanagement </li>
                                <li>IT-Fachprozess-Analyse / Dokumentation</li>
                            </ul>
                        </li>
                        <li>Software-Entwicklung
                            <ul>
                                <li>Microservices, SOA, REST, OOA und OOD</li>
                                <li>Microsoft Technologien z.B. .NET (C#), WPF, WCF</li>
                                <li>Datenbanken (MS SQL Server / Oracle / MongoDB)
                            </ul>
                            </li>
                    </ul>
                </section>
            </section>
            <section>
                <h2>Microservices ?!</h2>
                <img src="images/Prozesskette_gesamt.svg" style="border:0px;width:900px" alt="Übersicht für Beispiel Prozessketten">
            </section>
            <section>
                <section>
                    <h2>RabbitMQ - ein Überblick</h2>
                    <img src="images/logo_rabbitmq.png" style="border:0px" alt="Logo of Rabbit MQ" />
                </section>
                <section>
                    <h3>Was ist RabbitMQ?</h3>
                    <ul>
                        <li>Message Broker / Queue Manager
                            <ul>
                                <li>System um Queues zu verwalten</li>
                                <li>Nachrichten von Systemen empfangen</li>
                                <li>Nachrichten zwischenspeichern
                                    <li>Nachrichten nach Regeln an Systeme zustellen</li>
                            </ul>
                            <li>Erstellt in
                                <a href="https://de.wikipedia.org/w/index.php?title=Erlang_(Programmiersprache)" target="_blank"> Erlang / OTP</a>
                            </li>
                            <li>Erlaubt Entkopplung von unterschiedlichen und unabhängigen Anwendungen</li>
                    </ul>
                </section>
            </section>
            <section>
                <section>
                    <h2>Nachrichtentransport</h2>
                    <img src="images/MessageFlow.svg" alt="Übersicht Nachrichtentransport">
                </section>
                <section>
                    <h3>12 Begriffe sollt ihr sein </h3>
                    <img src="images/confused.jpg" alt="confused" />
                </section>
                <section>
                    <p class="fragment grow">
                        AMQP (Advanced Message Queuing Protocol)
                        <br/>
                        <i>Protokoll zur Kommunikation über Systemgrenzen</i>
                    </p>
                    <br/>
                    <p class="fragment grow">
                        Produzent (Producer)</br>
                        <i>Anwendung, die eine Nachricht erstellt</i>
                    </p>
                    <br/>
                    <p class="fragment grow">
                        Konsument (Consumer)</br>
                        <i>Anwendung, die eine Nachricht empfängt</i>
                    </p>
                </section>
                <section>
                    <p class="fragment grow">
                        Nachricht (Message)
                        <br/>
                        <i>Information, die zwischen Produzent und Konsument ausgetauscht wird</i>
                    </p>
                    <br/>
                    <p class="fragment grow">
                        Warteschlange (Queue)
                        <br/>
                        <i>Speichert die Nachrichten zwischen</i>
                    </p>
                    <br/>
                    <p class="fragment grow">
                        Verbindung (Connection)
                        <br/>
                        <i>TCP Netzwerkverbindung zwischen Anwendung und RabbitMQ broker</i>
                    </p>
                </section>
                <section>
                    <p class="fragment grow">
                        Channel
                        <br/>
                        <i>Virtuelle Verbindung innerhalb der TCP-Verbindung</i>
                    </p>
                    </br>
                    <p class="fragment grow">
                        Binding
                        <br/>
                        <i>Verknüpfung zwischen Queue und Exchange</i>
                    </p>
                    </br>
                    <p class="fragment grow">
                        Routing key
                        <br/>
                        <i>"Adresse", nach welcher der Exchange entscheidet, in welche Queue er die Nachricht leitet.</i>
                        <br/>
                    </p>
                </section>
                <section>
                    <p class="fragment grow">
                        Benutzer (User)
                        <br/>
                        <ul class="fragment grow">
                            <li>Zugangsdaten (Benutzername / Password) für RabbitMQ</li>
                            <li>Zuordnung von Rechten (Lesen, Schreiben, Konfigurieren etc.)
                                <li>Definition global oder für einen spezifischen virtuellen Host</li>
                        </ul>
                    </p>
                    </br>
                    <p class="fragment grow">
                        Vhost (virtual host)</br>
                        <i>Erlaubt, Anwendung auf einer RabbitMQ Instanz zu isolieren</i>
                    </p>
                </section>
                <section>
                    <h3>Exchange</h3>
                    <ul>
                        <li>Fanout Exchange
                            <ul>
                                <li>Eingehende Nachrichten werden an alle verbunden Queues gesendet</li>
                                <li>Keine Beachtung der Binding-Konfiguration</li>
                            </ul>
                        </li>
                        <li>Direct Exchange
                            <ul>
                                <li>Producer erstellt Routing Key</li>
                                <li>Binding Key der Queue muss exakt passen</li>
                            </ul>
                        </li>
                        <li>Topic
                            <ul>
                                <li>Ähnlich dem Direct Exchange </li>
                                <li>Einsatz von Platzhaltern, z.B. Wort (*) / mehrere Worte (#)</li>
                            </ul>
                        </li>
                        <li>Header Exchange
                            <ul>
                                <li>Routing anhand von Headerinformationen der Nachricht</li>
                            </ul>
                        </li>
                        <ul>
                </section>
            </section>
            <section>
                <section>
                    <h2>RabbitMQ - Installation</h2>
                </section>
                <section>
                    <h3>Installation Windows</h3>
                    Erlang OTP
                    <a href="https://www.erlang.org/downloads" target="_blank" alt="Download Erlang OTP">Download</a> (Voraussetzung)
                    <br /> RabbitMQ
                    <a href="http://www.rabbitmq.com/download.html" target="_blank" alt="Download RabbitMQ">Download</a>
                    <br />
                    <div style="border:0px;height:500px;">
                        <img src="images/rabbitmq_info.png" class="fragment current-visible" alt="Screenshot install RabbitMQ step 2" style="border:0px;margin-left:250px;margin-top:50px">
                        <!--
                        <img src="images/erlang_1.png" class="fragment current-visible" alt="Screenshot install erlang step 1" style="border:0px">
                        <img src="images/erlang_2.png" class="fragment current-visible" alt="Screenshot install erlang step 2" style="border:0px;margin-left:25px">
                        <img src="images/erlang_3.png" class="fragment current-visible" alt="Screenshot install erlang step 3" style="border:0px;margin-left:50px">
                        <img src="images/erlang_4.png" class="fragment current-visible" alt="Screenshot install erlang step 4" style="border:0px;margin-left:75px">
                        <img src="images/erlang_5.png" class="fragment current-visible" alt="Screenshot install erlang step 5" style="border:0px;margin-left:100px">
                        <img src="images/rabbitmq_1.png" class="fragment current-visible" alt="Screenshot install RabbitMQ step 1" style="border:0px;margin-left:125px">
                        <img src="images/rabbitmq_2.png" class="fragment current-visible" alt="Screenshot install RabbitMQ step 2" style="border:0px;margin-left:150px">
                        <img src="images/rabbitmq_3.png" class="fragment current-visible" alt="Screenshot install RabbitMQ step 2" style="border:0px;margin-left:175px">
                        <img src="images/rabbitmq_4.png" class="fragment current-visible" alt="Screenshot install RabbitMQ step 2" style="border:0px;margin-left:200px">
                        <img src="images/rabbitmq_5.png" class="fragment current-visible" alt="Screenshot install RabbitMQ step 2" style="border:0px;margin-left:225px">
                        <img src="images/rabbitmq_6.png" class="fragment current-visible" alt="Screenshot install RabbitMQ step 2" style="border:0px;margin-left:250px">
                        -->
                    </div>
                </section>
                <section>
                    <h3>Installation Linux</h3>
                    <br />
                    <pre>
                    <code class="bash" data-trim contenteditable>
                                        apt-get install rabbitmq-server 
                                    </code>
                                </pre>

                </section>
                <section>
                    <h3>Management Plugin </h3>
                    <a href="https://www.rabbitmq.com/management.html" alt="Infoseite Management PlugIn" target="_blank">Infos</a>
                    <br />
                    <img src="images/rabbitmq_management.png" alt="Screenshot Management Oberfläche" style="border:0px;height:550px" />
                </section>
                <section>
                    <h2>Docker</h2>
                    Standardimage auf Dockerhub
                    <img src="images/dockerhubRabbitmq.png" style="border:0px" alt="Screenshot Dockerhub" />
                </section>
                <section>
                    <h3>Starten RabbitMQ Instanz</h3>
                    <pre>
                                    <code data-trim contenteditable>
                                        $ docker run -d --hostname my-rabbit --name firstRabbit rabbitmq:3
                                    </code>
                                </pre>
                    <br /> Starten mit Management Plugin
                    <pre>
                                    <code data-trim contenteditable>$ docker run -d --hostname myRabbit --name myRabbit 
    -p 5672:5672 -p 15672:15672 rabbitmq:3-management
                                    </code>
                                </pre>
                </section>
            </section>
            <section>
                <section>
                    <h2>EasyNetQ</h2>
                    <img src="images/logo_easynetq.png" style="border:0px" alt="Logo EasyNetQ">
                    <ul>
                        <li>Einfach</li>
                        <li>Open Source</li>
                        <li>Modular</li>
                        <br />
                    </ul>
                    </br>
                    </br>
                    Nuget:
                    <a href="https://www.nuget.org/packages/EasyNetQ/" target="_blank">EasyNetQ</a>
                    </br>
                    Github:
                    <a href="https://github.com/EasyNetQ/EasyNetQ" target="_blank">https://github.com/EasyNetQ/EasyNetQ</a>
                </section>
                <section>
                    <h3>Warum nicht direkt</h3>
                    Subscriber
                    <pre><code class="cs">
var factory = new ConnectionFactory() { HostName = "localhost" };
using (var connection = factory.CreateConnection())
using (var channel = connection.CreateModel())
{
channel.ExchangeDeclare(exchange: "logs", type: "fanout");
var queueName = channel.QueueDeclare().QueueName;
channel.QueueBind(queue: queueName, exchange: "logs", 
    routingKey: "");
var consumer = new EventingBasicConsumer(channel);
consumer.Received += (model, ea) =>{
    var message = Encoding.UTF8.GetString(ea.Body);
    DoSomething(MyMessage.Deserialize(message));    };
channel.BasicConsume(queue: queueName, noAck: true,
 consumer: consumer);
}</code></pre>
                </section>
                <section>
                    Publisher
                    <pre><code class="cs">
var factory = new ConnectionFactory() { HostName = "localhost" };
using (var connection = factory.CreateConnection())
using (var channel = connection.CreateModel())
{
channel.ExchangeDeclare(exchange: "logs", type: "fanout");
var message = new MyMessage {Content = "Hallo Welt"};
var body = Encoding.UTF8.GetBytes(message.Serialize());
channel.BasicPublish(exchange: "logs", routingKey: "",
        basicProperties: null, body: body);
}
</code></pre> Serialisierung, Fehlerbehandlung ...
                    <span class="fragment">fehlt alles noch</span>
                </section>
                <section>
                    <h3>Vorteile</h3>
                    <ul>
                        <li>Messaging Pattern, z.B. Publish/Subscribe </li>
                        <li>Routing Strategien</li>
                        <li>Serialisierung / Deserialisierung als JSON (lesbar)</li>
                        <li>Handling von Thread für Konsumenten</li>
                        <li>Subscriber Reconnect</li>
                        <li>QoS / publisher confirm</li>
                        <li>Fehlerbehandlung</li>
                    </ul>
                </section>
                <section>
                    <h3>API Design</h3>
                    <img src="images/EasyNetQ.svg" alt="API EasyNETQ" style="border:0px">
                </section>

            </section>
            <section>
                <section>
                    <h2>EasyNetQ Einstieg</h2>
                </section>

                <section>
                    <h3>Verbindungsaufbau</h3>
                    <pre><code class="cs">
using System;
using EasyNetQ;

namepace FP.MsRmq.Connecting
{
public class Programm
{
    public static void Main(string[] args)
    {
        var myBus = RabbitHutch.CreateBus("host=myRabbitMQ");
    }
}
}
</code>
                </pre>
                </section>
                <section>
                    <h3>Verbindungsoptionen</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Option</th>
                                <th>Standardwert</th>
                                <th>Bemerkung</th>
                        </thead>
                        <tbody>
                            <tr>
                                <td>host</td>
                                <td>5672</td>
                                <td>DNS-Name/IP[:Port]</td>
                            </tr>
                            <tr>
                                <td>username</td>
                                <td>guest</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>passwort</td>
                                <td>guest</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>prefetchcount</td>
                                <td>50</td>
                                <td>Anzahl der Nachrichten, die gleichzeitig abgerufen werden</td>
                            </tr>
                            <tr>
                                <td>timeout</td>
                                <td>10</td>
                                <td>timeout in Sekunden</td>
                            </tr>
                            <tr>
                                <td>publisherConfirms</td>
                                <td>false</td>
                                <td>Erzwingt eine Annahmebestätigung</td>
                            </tr>
                        </tbody>
                    </table>
                </section>
                <section>
                    <h3>Publish / Subscribe</h3>
                    Sendet eine Nachricht an beliebig viele Empfänger
                    <br/>
                    <br/> Wenn kein Empfänger definiert wurde, geht Nachricht verloren (keine Speicherung / Verarbeitung)
                    <br />
                    <br /> Zieltypen der Bestellung müssen übereinstimmen
                    <br />
                    <br /> Polymorphy ist möglich
                    </ul>
                </section>
                <section>
                    Subscribe
                    <pre><code class="cs">
myBus.Subscribe&lt;MyClass&gt;("MySub", 
    msg => DoSomething(msg));
myBus.SubscribeAsync&lt;MyClass&gt;("MySubAsync",
    msg => DoSomethingAsync(msg));
 </code>
                </pre> Publish
                    <pre><code class="cs">
var msg = new MyClass{};                            
myBus.Publish(msg);
myBus.PublishAsync(msg);
 </code>
                </pre>
                </section>
                <section>
                    <h3>Topic Based Routing</h3>
                    Sonderform des Publish / Subscribe
                    <br/>
                    <br/> Neben dem Zieltyp muss auch das Thema (Topic) passen
                    <br/>
                    <br/> Im Thema sind Platzhalter möglich

                </section>
                <section>
                    Subscribe
                    <pre><code class="cs">
myBus.Subscribe&lt;MyClass&gt;("MyTopicSub", 
    msg => DoSomething(msg), x => x.WithTopic("MyTopic"));
 </code>
                </pre> Publish
                    <pre><code class="cs">
var msg = new MyClass{};                            
myBus.Publish(msg, "MyTopic");
 </code>
                </pre>
                </section>
                <section>
                    <h3>Request / Response (RPC)</h3>
                    Sendet eine Nachricht und erwartet eine Antwort
                    <br />
                    <br /> Matching über Typen der Anfrage und der Antwort
                    <br/>
                    <br /> Exception, wenn Antwort nicht innerhalb Timeout
                </section>
                <section>
                    Response
                    <pre><code class="cs">
                      
myBus.Respond&lt;MyClass1,MyClass2&gt;(DoSometingWithResult);
myBus.RespondAsync&lt;MyClass1,MyClass2&gt;(DoSometingAsyncWithResult);
                </code></pre> Request
                    <pre><code class="cs">
var req = new MyClass1{};                            
var result = myBus.Request&lt;MyClass1,MyClass2&gt;(req);
var result = await myBus.RequestAsync&lt;MyClass1,MyClass2&gt;(req);
                </code></pre>
                </section>
                <section>
                    <h3>Send / Receive (Command Pipelines)</h3>
                    Command Pipelines
                    <br />
                    <br /> Queue enthält Nachrichten verschiedener Typen
                    <br />
                    <br /> Bestellung wird auf den Nachrichtentyp eingegrenzt
                    <br />
                    <br /> Nicht zustellbare Nachrichten werden in Error-Queue übertragen
                </section>
                <section>
                    Receive
                    <pre><code class="cs">
myBus.Receive("MyMessageQueue", x => x
.Add&lt;MyClassA&gt;(DoSomethingWithA)
.Add&lt;MyClassB&gt;(DoSomethingWithB);
                </code></pre> Request
                    <pre><code class="cs">
myBus.Send("MyMessageQueue", new MyClassA {});
myBus.Send("MyMessageQueue", new MyClassB {});

                </code></pre>
                </section>
                <section>
                    <h3>Fehlerbehandlung</h3>
                    Queue:
                    <b>EasyNetQ_Default_Error_Queue</b>
                    </br>
                    Tool: EasyNetQ.Hosepipe utility (Re-Publish)
                </section>
            </section>
            <section>
                <section>
                    <h2>Weblogger</h2>
                    <img src="images/weblogger.svg" style="border:0px;width:700px" alt="Übersicht für Beispiel Weblogger">
                </section>
            </section>
            <section>
                <section>
                    <h2>Prozessketten mit Webbroker für Fortgeschrittene</h2>
                </section>
                <section>
                    <h3>Problem - große Nachrichten</h3>
                    Trennung von Befehlen und Daten
                </section>
                <section>
                    <img src="images/Prozesskette_mongo.svg" style="border:0px;width:900px" alt="Übersicht für Beispiel Prozesskette mit MongoDB">
                </section>
            </section>
            <section>
                <h2>Fragen<span class="fragment">?</span></h2>
                <br />
                <br />
                <h1 class="fragment">Vielen Dank</h1>
            </section>
        </div>
    </div>
    <script src="./common/lib/js/head.min.js"></script>
    <script src="./common/js/reveal.js"></script>

    <script>
        // More info https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            center: true,
            width: 1250,
            height: 720,
            slideNumber: true,
            margin: 0.0,

            menu: {
                side: 'left',

                titleSelector: 'h1, h2, h3, h4, h5, h6',
                hideMissingTitles: false,
                markers: false,
                custom: false,
                themes: [
                    { name: 'Black', theme: './common/css/theme/black.css' },
                    { name: 'White', theme: './common/css/theme/white.css' },
                    { name: 'League', theme: './common/css/theme/league.css' },
                    { name: 'Sky', theme: './common/css/theme/sky.css' },
                    { name: 'Beige', theme: './common/css/theme/beige.css' },
                    { name: 'Simple', theme: './common/css/theme/simple.css' },
                    { name: 'Serif', theme: './common/css/theme/serif.css' },
                    { name: 'Blood', theme: './common/css/theme/blood.css' },
                    { name: 'Night', theme: './common/css/theme/night.css' },
                    { name: 'Moon', theme: './common/css/theme/moon.css' },
                    { name: 'Solarized', theme: './common/css/theme/solarized.css' }
                ],

                transitions: true,
                openButton: true,
                openSlideNumber: false,
                keyboard: true,
                sticky: false,
                autoOpen: true
            },

            // More info https://github.com/hakimel/reveal.js#dependencies
            dependencies: [
                { src: './common/lib/js/classList.js', condition: function () { return !document.body.classList; } },
                { src: './common/plugin/markdown/marked.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
                { src: './common/plugin/markdown/markdown.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
                { src: './common/plugin/notes/notes.js', async: true },
                { src: './common/plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } },
                { src: './common/plugin/zoom-js/zoom.js', async: true },
                { src: './common/plugin/notes/notes.js', async: true },
                { src: './common/plugin/menu/menu.js', async: true }
            ]
        });
    </script>
</body>


</html>